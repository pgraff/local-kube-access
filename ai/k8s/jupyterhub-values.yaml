# JupyterHub Helm Chart Values
# Zero-to-JupyterHub configuration for AI workspace

hub:
  # Use default image from chart - will use appropriate version automatically
  # image:
  #   name: jupyterhub/k8s-hub
  #   tag: "3.1.1"
  
  config:
    JupyterHub:
      authenticator_class: dummy
      admin_users:
        - admin
    DummyAuthenticator:
      password: "jupyterhub"  # Default password for all users
    
    # Allow any username/password combination
    Authenticator:
      admin_users:
        - admin
    
    # Spawner configuration
    KubeSpawner:
      events_enabled: false  # Disable event reflector to avoid timeout issues
      start_timeout: 300  # 5 minutes for PVC creation and pod startup
      k8s_api_request_timeout: 60  # 1 minute for Kubernetes API requests
  
  # Service configuration
  service:
    type: ClusterIP
    annotations: {}
  
  # Hub database storage (use local-path to avoid Longhorn attachment issues)
  db:
    type: sqlite-pvc
    pvc:
      storageClassName: local-path  # Use local-path instead of Longhorn for hub database
      accessModes:
        - ReadWriteOnce
      storage: 1Gi

# Single-user notebook configuration
singleuser:
  # Use JupyterLab as default
  defaultUrl: /lab
  
  # Image with Python 3.10+, conda, pip, papermill, and MinIO client
  image:
    name: jupyter/scipy-notebook
    tag: "python-3.10"
  
  # Storage configuration - 10GB PVC per user
  storage:
    type: dynamic
    capacity: 10Gi
    dynamic:
      storageClass: local-path  # Use local-path for faster provisioning (local disk, no replication)
  
  # Spawner timeout
  startTimeout: 300  # 5 minutes for PVC creation and pod startup
  
  # Environment variables for MinIO access
  extraEnv:
    MINIO_ENDPOINT: "minio.ai.svc.cluster.local:9000"
    MINIO_BUCKET: "notebook-artifacts"
    MINIO_ACCESS_KEY: "minioadmin"
    MINIO_SECRET_KEY: "minioadmin"
    MINIO_REGION: "us-east-1"
    MINIO_USE_SSL: "false"
  
  # Lifecycle hooks to install papermill and boto3 (MinIO S3 client)
  lifecycleHooks:
    postStart:
      exec:
        command:
          - /bin/bash
          - -c
          - |
            pip install --quiet --no-cache-dir papermill boto3 s3fs
            echo "Papermill and MinIO client installed"
  
  # Network policy to allow access to MinIO and cluster services
  networkPolicy:
    enabled: false  # Disable network policy to allow hub pod to access Kubernetes API
    # Note: Network policies were blocking hub pod from accessing Kubernetes API server
    # which caused reflector timeouts. Disabling for now - can be re-enabled with proper
    # egress rules for API server access if needed.

# Proxy configuration
proxy:
  service:
    type: ClusterIP
  https:
    enabled: false

# Scheduling configuration
scheduling:
  userScheduler:
    enabled: false
  podPriority:
    enabled: false

# Pre-puller configuration (disable to avoid timeout issues)
prePuller:
  hook:
    enabled: false
  continuous:
    enabled: false

# RBAC configuration
rbac:
  create: true

# Debug mode
debug:
  enabled: false

